"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[699],{25699:function(e,a,t){t.d(a,{default:function(){return v}});var s=t(57437),n=t(2265),r=t(34029),c=t(92595),l=t(81973),i=t(46393),d=t(95252),o=t(99584),u=t(41671),x=t(76865),m=t(70525),f=t(3085);function p(e,a){let t=a.filter(a=>a.account_id===e.id),s=t.filter(e=>"income"===e.type).reduce((e,a)=>e+a.amount,0),n=t.filter(e=>"expense"===e.type).reduce((e,a)=>e+a.amount,0);return{accountId:e.id,accountName:e.name,accountType:e.type,currentBalance:s-n,totalIncome:s,totalExpenses:n,transactionCount:t.length}}function h(e,a,t){let s=e.map(e=>p(e,a)),n=t?s.filter(e=>t.includes(e.accountId)):s,r=n.reduce((e,a)=>e+a.currentBalance,0);return{totalBalance:r,totalIncome:n.reduce((e,a)=>e+a.totalIncome,0),totalExpenses:n.reduce((e,a)=>e+a.totalExpenses,0),accountBalances:s,filteredBalance:t?r:void 0,filteredAccounts:t}}var j=t(58113),N=t(18420),g=t(22835);function v(e){var a,t;let{accounts:v,transactions:b,onTransferComplete:y}=e,[w,I]=(0,n.useState)(""),[C,T]=(0,n.useState)(""),[S,_]=(0,n.useState)(""),[Z,k]=(0,n.useState)(""),[B,D]=(0,n.useState)([]),[E,F]=(0,n.useState)(null),[R,A]=(0,n.useState)([]),{createTransfer:G,validateTransferData:V,isTransferring:O}=function(){let[e,a]=(0,n.useState)(!1),{toast:t}=(0,N.pm)(),s=(0,j.e)();return{createTransfer:(0,n.useCallback)(async e=>{a(!0);try{let{outTransaction:a,inTransaction:n}={outTransaction:{account_id:e.fromAccountId,type:"expense",amount:e.amount,description:e.description||"Transfer\xeancia para ".concat(e.toAccountId),transaction_date:new Date().toISOString().split("T")[0],created_via:"transfer"},inTransaction:{account_id:e.toAccountId,type:"income",amount:e.amount,description:e.description||"Transfer\xeancia de ".concat(e.fromAccountId),transaction_date:new Date().toISOString().split("T")[0],created_via:"transfer"}},{error:r}=await s.from("transactions").insert(a);if(r)throw r;let{error:c}=await s.from("transactions").insert(n);if(c)throw c;return t({title:"Transfer\xeancia realizada!",description:"Valor de ".concat(e.amount," transferido com sucesso.")}),{success:!0}}catch(e){return console.error("Erro ao realizar transfer\xeancia:",e),t({variant:"destructive",title:"Erro na transfer\xeancia",description:"Tente novamente mais tarde."}),{success:!1,error:e}}finally{a(!1)}},[s,t]),validateTransferData:(0,n.useCallback)((e,a,t)=>t<=0?{isValid:!1,reason:"Valor deve ser maior que zero"}:e.currentBalance<t?{isValid:!1,reason:"Saldo insuficiente. Dispon\xedvel: ".concat(e.currentBalance.toFixed(2))}:e.accountId===a.accountId?{isValid:!1,reason:"N\xe3o \xe9 poss\xedvel transferir para a mesma conta"}:{isValid:!0},[]),isTransferring:e}}();(0,n.useEffect)(()=>{D(v.map(e=>p(e,b))),F(h(v,b))},[v,b]);let z=async()=>{if(!w||!C||!S)return;let e=B.find(e=>e.accountId===w),a=B.find(e=>e.accountId===C);if(!e||!a)return;let t=parseFloat(S),s=V(e,a,t);if(!s.isValid){alert(s.reason);return}(await G({fromAccountId:w,toAccountId:C,amount:t,description:Z||"Transfer\xeancia - ".concat(new Date().toLocaleDateString())})).success&&(I(""),T(""),_(""),k(""),null==y||y())},Y=(e,a)=>{a?A([...R,e]):A(R.filter(a=>a!==e))},q=R.length>0?h(v,b,R):E;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(r.Zb,{children:[(0,s.jsx)(r.Ol,{children:(0,s.jsxs)(r.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Z,{className:"h-5 w-5 text-green-600"}),"Saldo Consolidado"]})}),(0,s.jsxs)(r.aY,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Saldo Total"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:(0,g.xG)((null==q?void 0:q.totalBalance)||0)})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Total Receitas"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:(0,g.xG)((null==q?void 0:q.totalIncome)||0)})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Total Despesas"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-red-600",children:(0,g.xG)((null==q?void 0:q.totalExpenses)||0)})]})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium mb-3",children:"Filtrar por contas:"}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:B.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:R.includes(e.accountId),onChange:a=>Y(e.accountId,a.target.checked),className:"rounded"}),(0,s.jsx)("span",{className:"text-sm",children:e.accountName})]},e.accountId))}),R.length>0&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Mostrando saldo de ",R.length," conta(s) selecionada(s)"]})]})]})]}),(0,s.jsxs)(r.Zb,{children:[(0,s.jsx)(r.Ol,{children:(0,s.jsxs)(r.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(o.Z,{className:"h-5 w-5 text-blue-600"}),"Transfer\xeancia entre Contas"]})}),(0,s.jsx)(r.aY,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i._,{htmlFor:"fromAccount",children:"Conta de Origem"}),(0,s.jsxs)("select",{id:"fromAccount",value:w,onChange:e=>I(e.target.value),className:"w-full p-2 border rounded-md",children:[(0,s.jsx)("option",{value:"",children:"Selecione a conta de origem"}),B.map(e=>(0,s.jsxs)("option",{value:e.accountId,children:[e.accountName," -"," ",(0,g.xG)(e.currentBalance)]},e.accountId))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i._,{htmlFor:"toAccount",children:"Conta de Destino"}),(0,s.jsxs)("select",{id:"toAccount",value:C,onChange:e=>T(e.target.value),className:"w-full p-2 border rounded-md",children:[(0,s.jsx)("option",{value:"",children:"Selecione a conta de destino"}),B.map(e=>(0,s.jsxs)("option",{value:e.accountId,children:[e.accountName," -"," ",(0,g.xG)(e.currentBalance)]},e.accountId))]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i._,{htmlFor:"amount",children:"Valor da Transfer\xeancia"}),(0,s.jsx)(l.I,{id:"amount",type:"number",step:"0.01",value:S,onChange:e=>_(e.target.value),placeholder:"0.00"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(i._,{htmlFor:"description",children:"Descri\xe7\xe3o (Opcional)"}),(0,s.jsx)(l.I,{id:"description",value:Z,onChange:e=>k(e.target.value),placeholder:"Ex: Transfer\xeancia mensal"})]})]}),w&&C&&S&&(0,s.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 text-green-600"}),(0,s.jsx)("span",{className:"font-medium",children:"Resumo da Transfer\xeancia"})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Transferir"," ",(0,s.jsx)("strong",{children:(0,g.xG)(parseFloat(S))})," ","de"," ",(0,s.jsx)("strong",{children:null===(a=B.find(e=>e.accountId===w))||void 0===a?void 0:a.accountName})," ","para"," ",(0,s.jsx)("strong",{children:null===(t=B.find(e=>e.accountId===C))||void 0===t?void 0:t.accountName})]}),(()=>{let e=B.find(e=>e.accountId===w),a=B.find(e=>e.accountId===C);if(e&&a){let t=V(e,a,parseFloat(S));if(!t.isValid)return(0,s.jsxs)("p",{className:"text-sm text-red-600 mt-2 flex items-center gap-1",children:[(0,s.jsx)(x.Z,{className:"h-4 w-4"}),t.reason]})}return null})()]}),(0,s.jsx)(c.z,{onClick:z,disabled:!w||!C||!S||O,className:"w-full",children:O?"Transferindo...":"Realizar Transfer\xeancia"})]})})]}),(0,s.jsxs)(r.Zb,{children:[(0,s.jsx)(r.Ol,{children:(0,s.jsxs)(r.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"h-5 w-5 text-purple-600"}),"Saldos das Contas"]})}),(0,s.jsx)(r.aY,{children:(0,s.jsx)("div",{className:"space-y-3",children:B.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.currentBalance>=0?"bg-green-500":"bg-red-500")}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.accountName}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[e.transactionCount," transa\xe7\xf5es â€¢"," ",e.accountType]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-lg font-bold ".concat(e.currentBalance>=0?"text-green-600":"text-red-600"),children:(0,g.xG)(e.currentBalance)}),(0,s.jsxs)("div",{className:"flex gap-4 text-xs text-gray-500",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(m.Z,{className:"h-3 w-3"}),(0,g.xG)(e.totalIncome)]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(f.Z,{className:"h-3 w-3"}),(0,g.xG)(e.totalExpenses)]})]})]})]},e.accountId))})})]})]})}},34029:function(e,a,t){t.d(a,{Ol:function(){return l},SZ:function(){return d},Zb:function(){return c},aY:function(){return o},eW:function(){return u},ll:function(){return i}});var s=t(57437),n=t(2265),r=t(22835);let c=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});c.displayName="Card";let l=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",t),...n})});l.displayName="CardHeader";let i=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,s.jsx)("h3",{ref:a,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});i.displayName="CardTitle";let d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,s.jsx)("p",{ref:a,className:(0,r.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let o=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("p-6 pt-0",t),...n})});o.displayName="CardContent";let u=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("flex items-center p-6 pt-0",t),...n})});u.displayName="CardFooter"},46393:function(e,a,t){t.d(a,{_:function(){return d}});var s=t(57437),n=t(2265),r=t(6394),c=t(90535),l=t(22835);let i=(0,c.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=n.forwardRef((e,a)=>{let{className:t,...n}=e;return(0,s.jsx)(r.f,{ref:a,className:(0,l.cn)(i(),t),...n})});d.displayName=r.f.displayName}}]);