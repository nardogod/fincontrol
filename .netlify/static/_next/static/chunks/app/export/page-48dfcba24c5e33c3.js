(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{24028:function(e,t,a){Promise.resolve().then(a.bind(a,21156)),Promise.resolve().then(a.bind(a,9592))},21156:function(e,t,a){"use strict";a.d(t,{default:function(){return m}});var n=a(57437),s=a(2265),r=a(92595),o=a(3805),i=a(46393),d=a(81973),l=a(58113),c=a(18420),u=a(92735);function m(e){let{accounts:t,format:a}=e,m=(0,l.e)(),[p,f]=(0,s.useState)(!1),[x,h]=(0,s.useState)(!1),g=new Date,j=new Date(g.getFullYear(),g.getMonth(),1).toISOString().split("T")[0],N=new Date(g.getFullYear(),g.getMonth()+1,0).toISOString().split("T")[0],[v,y]=(0,s.useState)(j),[b,w]=(0,s.useState)(N),[_,C]=(0,s.useState)(t.map(e=>e.id)),k=e=>{C(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},D=async()=>{if(0===_.length){(0,c.Am)({variant:"destructive",title:"Erro de valida\xe7\xe3o",description:"Selecione pelo menos uma conta."});return}h(!0);try{let{data:e,error:t}=await m.from("transactions").select("*, category:categories(*), account:accounts(*)").in("account_id",_).gte("transaction_date",v).lte("transaction_date",b).order("transaction_date",{ascending:!1});if(t)throw t;if(!e||0===e.length){(0,c.Am)({variant:"destructive",title:"Nenhum dado encontrado",description:"N\xe3o h\xe1 transa\xe7\xf5es no per\xedodo selecionado."});return}"csv"===a&&function(e,t,a){let n=e.map(e=>{var t,a,n;return[(a=e.transaction_date,new Date(a).toISOString().split("T")[0]),"income"===e.type?"Entrada":"Sa\xedda",(null===(t=e.category)||void 0===t?void 0:t.name)||"Sem categoria",e.account.name,e.amount.toFixed(2).replace(".",","),(n=e.description||"").includes(",")||n.includes("\n")||n.includes('"')?'"'.concat(n.replace(/"/g,'""'),'"'):n]}),s=["Data,Tipo,Categoria,Conta,Valor (SEK),Descri\xe7\xe3o",...n.map(e=>e.join(","))].join("\n"),r=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"});!function(e,t){let a=document.createElement("a"),n=URL.createObjectURL(e);a.setAttribute("href",n),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}(r,"fincontrol_".concat(t,"_").concat(a,".csv"))}(e,v,b);let{data:n}=await m.auth.getUser();n.user&&await m.from("export_history").insert({user_id:n.user.id,format:a,period_start:v,period_end:b}),(0,c.Am)({title:"Exporta\xe7\xe3o conclu\xedda!",description:"".concat(e.length," transa\xe7\xf5es exportadas com sucesso.")}),f(!1)}catch(e){console.error("Export error:",e),(0,c.Am)({variant:"destructive",title:"Erro ao exportar",description:"Tente novamente mais tarde."})}finally{h(!1)}};return(0,n.jsxs)(o.Vq,{open:p,onOpenChange:f,children:[(0,n.jsx)(o.hg,{asChild:!0,children:(0,n.jsxs)(r.z,{className:"w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700",children:[(0,n.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Exportar CSV"]})}),(0,n.jsxs)(o.cZ,{className:"sm:max-w-[500px]",children:[(0,n.jsxs)(o.fK,{children:[(0,n.jsx)(o.$N,{children:"Exportar Transa\xe7\xf5es"}),(0,n.jsx)(o.Be,{children:"Configure o per\xedodo e as contas que deseja exportar"})]}),(0,n.jsxs)("div",{className:"space-y-4 py-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(i._,{htmlFor:"startDate",children:"Data inicial"}),(0,n.jsx)(d.I,{id:"startDate",type:"date",value:v,onChange:e=>y(e.target.value),disabled:x})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(i._,{htmlFor:"endDate",children:"Data final"}),(0,n.jsx)(d.I,{id:"endDate",type:"date",value:b,onChange:e=>w(e.target.value),disabled:x})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(i._,{children:"Contas"}),(0,n.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,n.jsxs)("label",{className:"flex cursor-pointer items-center gap-2 rounded-lg border p-3 transition-colors hover:bg-slate-50",children:[(0,n.jsx)("input",{type:"checkbox",checked:_.includes(e.id),onChange:()=>k(e.id),disabled:x,className:"h-4 w-4 rounded border-slate-300"}),(0,n.jsx)("span",{className:"text-xl",children:e.icon}),(0,n.jsx)("span",{className:"font-medium",children:e.name})]},e.id))})]})]}),(0,n.jsxs)(o.cN,{children:[(0,n.jsx)(r.z,{variant:"outline",onClick:()=>f(!1),disabled:x,children:"Cancelar"}),(0,n.jsx)(r.z,{onClick:D,disabled:x,children:x?"Exportando...":"Exportar"})]})]})]})}},3805:function(e,t,a){"use strict";a.d(t,{$N:function(){return x},Be:function(){return h},Vq:function(){return d},cN:function(){return f},cZ:function(){return m},fK:function(){return p},hg:function(){return l}});var n=a(57437),s=a(2265),r=a(49027),o=a(32489),i=a(22835);let d=r.fC,l=r.xz,c=r.h_;r.x8;let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});u.displayName=r.aV.displayName;let m=s.forwardRef((e,t)=>{let{className:a,children:s,...d}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(u,{}),(0,n.jsxs)(r.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[s,(0,n.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(o.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=r.VY.displayName;let p=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};p.displayName="DialogHeader";let f=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};f.displayName="DialogFooter";let x=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});x.displayName=r.Dx.displayName;let h=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})});h.displayName=r.dk.displayName},46393:function(e,t,a){"use strict";a.d(t,{_:function(){return l}});var n=a(57437),s=a(2265),r=a(6394),o=a(90535),i=a(22835);let d=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,n.jsx)(r.f,{ref:t,className:(0,i.cn)(d(),a),...s})});l.displayName=r.f.displayName}},function(e){e.O(0,[828,972,494,945,707,428,971,117,744],function(){return e(e.s=24028)}),_N_E=e.O()}]);