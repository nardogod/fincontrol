(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{26815:function(e,t,a){Promise.resolve().then(a.bind(a,25315)),Promise.resolve().then(a.bind(a,12870))},25315:function(e,t,a){"use strict";a.d(t,{default:function(){return X}});var s=a(57437),n=a(2265),r=a(66706),l=a(53225),o=a(17583),i=a(21018),c=a(44644),d=a(11005),m=a(11240),u=a(94499),x=a(16081),h=a(7880);function g(e){let{accounts:t,activeAccountId:a,onAccountChange:n}=e,r=e=>{switch(e){case"personal":default:return(0,s.jsx)(d.Z,{className:"h-4 w-4"});case"shared":return(0,s.jsx)(m.Z,{className:"h-4 w-4"});case"business":return(0,s.jsx)(u.Z,{className:"h-4 w-4"});case"vehicle":return(0,s.jsx)(x.Z,{className:"h-4 w-4"})}};return 0===t.length?(0,s.jsx)("div",{className:"text-center text-sm text-slate-500",children:"Nenhuma conta encontrada"}):(0,s.jsx)("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide",children:t.map(e=>{let t=a===e.id;return(0,s.jsxs)(c.z,{onClick:()=>n(e.id),variant:t?"default":"outline",className:(0,h.cn)("whitespace-nowrap transition-all relative",t?"scale-105 shadow-lg":"border-slate-200 bg-white text-slate-600 hover:bg-slate-50"),style:t?{backgroundColor:e.color,borderColor:e.color}:void 0,children:[r(e.type),(0,s.jsx)("span",{children:e.name}),e.is_shared&&(0,s.jsx)("div",{className:"ml-1 h-2 w-2 rounded-full bg-blue-500",title:"Conta compartilhada"})]},e.id)})})}var p=a(404),f=a(74697),j=a(24241),b=a(77536);function v(e){var t,a,r,l;let{accounts:o,categories:d,onFiltersChange:m,activeFilters:u}=e,[x,h]=(0,n.useState)(!1),g=[{value:"current-month",label:"Este m\xeas"},{value:"last-month",label:"M\xeas passado"},{value:"last-3-months",label:"\xdaltimos 3 meses"},{value:"last-6-months",label:"\xdaltimos 6 meses"},{value:"current-year",label:"Este ano"},{value:"all",label:"Todos os per\xedodos"}],v=[{value:"all",label:"Todas"},{value:"income",label:"Receitas"},{value:"expense",label:"Despesas"}],N=(e,t)=>{m({...u,[e]:"all"===t?null:t})},y=u.accountId||u.categoryId||"current-month"!==u.period||u.type;return(0,s.jsxs)(i.Zb,{className:"mb-6",children:[(0,s.jsx)(i.Ol,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(i.ll,{className:"flex items-center gap-2 text-lg",children:[(0,s.jsx)(p.Z,{className:"h-5 w-5"}),"Filtros do Dashboard"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[y&&(0,s.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>{m({accountId:null,categoryId:null,period:"current-month",type:null})},className:"text-red-600 hover:text-red-700",children:[(0,s.jsx)(f.Z,{className:"h-4 w-4 mr-1"}),"Limpar"]}),(0,s.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>h(!x),children:x?"Recolher":"Expandir"})]})]})}),x&&(0,s.jsxs)(i.aY,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Conta"}),(0,s.jsxs)(b.Ph,{value:u.accountId||"all",onValueChange:e=>N("accountId",e),children:[(0,s.jsx)(b.i4,{children:(0,s.jsx)(b.ki,{placeholder:"Selecionar conta"})}),(0,s.jsxs)(b.Bw,{children:[(0,s.jsx)(b.Ql,{value:"all",children:"Todas as contas"}),o.map(e=>(0,s.jsx)(b.Ql,{value:e.id,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.icon}),(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.type,")"]})]})},e.id))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Categoria"}),(0,s.jsxs)(b.Ph,{value:u.categoryId||"all",onValueChange:e=>N("categoryId",e),children:[(0,s.jsx)(b.i4,{children:(0,s.jsx)(b.ki,{placeholder:"Selecionar categoria"})}),(0,s.jsxs)(b.Bw,{children:[(0,s.jsx)(b.Ql,{value:"all",children:"Todas as categorias"}),d.map(e=>(0,s.jsx)(b.Ql,{value:e.id,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.icon}),(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["(","income"===e.type?"Receita":"Despesa",")"]})]})},e.id))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Per\xedodo"}),(0,s.jsxs)(b.Ph,{value:u.period,onValueChange:e=>N("period",e),children:[(0,s.jsx)(b.i4,{children:(0,s.jsx)(b.ki,{placeholder:"Selecionar per\xedodo"})}),(0,s.jsx)(b.Bw,{children:g.map(e=>(0,s.jsx)(b.Ql,{value:e.value,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(j.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e.label})]})},e.value))})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Tipo"}),(0,s.jsxs)(b.Ph,{value:u.type||"all",onValueChange:e=>N("type",e),children:[(0,s.jsx)(b.i4,{children:(0,s.jsx)(b.ki,{placeholder:"Selecionar tipo"})}),(0,s.jsx)(b.Bw,{children:v.map(e=>(0,s.jsx)(b.Ql,{value:e.value,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"income"===e.value?"text-green-600":"expense"===e.value?"text-red-600":"",children:"income"===e.value?"\uD83D\uDCB0":"expense"===e.value?"\uD83D\uDCB8":"\uD83D\uDCCA"}),(0,s.jsx)("span",{children:e.label})]})},e.value))})]})]})]}),y&&(0,s.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Filtros Ativos:"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[u.accountId&&(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:["Conta:"," ",null===(t=o.find(e=>e.id===u.accountId))||void 0===t?void 0:t.name]}),u.categoryId&&(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:["Categoria:"," ",null===(a=d.find(e=>e.id===u.categoryId))||void 0===a?void 0:a.name]}),"current-month"!==u.period&&(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:["Per\xedodo:"," ",null===(r=g.find(e=>e.value===u.period))||void 0===r?void 0:r.label]}),u.type&&(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:["Tipo:"," ",null===(l=v.find(e=>e.value===u.type))||void 0===l?void 0:l.label]})]})]})]})]})}var N=a(47019),y=a(75733),w=a(29162),D=a(51077),C=a(42421),_=a(87592),S=a(21902);function E(e){let{transactions:t,accounts:a,categories:r,period:o,activeAccountId:d,hideValues:m=!1,onToggleHideValues:u}=e,[x,g]=(0,n.useState)(!1),p=(0,n.useMemo)(()=>{let e=t.filter(e=>"income"===e.type).reduce((e,t)=>e+Number(t.amount),0),s=t.filter(e=>"expense"===e.type).reduce((e,t)=>e+Number(t.amount),0);return{total:{income:e,expense:s,balance:e-s},accounts:a.map(e=>{let a=t.filter(t=>t.account_id===e.id),s=a.filter(e=>"income"===e.type).reduce((e,t)=>e+Number(t.amount),0),n=a.filter(e=>"expense"===e.type).reduce((e,t)=>e+Number(t.amount),0);return{...e,income:s,expense:n,balance:s-n,transactionCount:a.length}}),topCategories:Object.values(t.reduce((e,t)=>{let a=t.category_id||"sem-categoria",s=r.find(e=>e.id===a),n=(null==s?void 0:s.name)||"Sem categoria",l=(null==s?void 0:s.icon)||"\uD83D\uDCE6";return e[a]||(e[a]={id:a,name:n,icon:l,type:t.type,income:0,expense:0,count:0}),"income"===t.type?e[a].income+=Number(t.amount):e[a].expense+=Number(t.amount),e[a].count+=1,e},{})).sort((e,t)=>t.income+t.expense-(e.income+e.expense)).slice(0,5),transactionCount:t.length}},[t,a]),f=e=>{switch(e){case"current-month":return"Este m\xeas";case"last-month":return"M\xeas passado";case"last-3-months":return"\xdaltimos 3 meses";case"last-6-months":return"\xdaltimos 6 meses";case"current-year":return"Este ano";case"all":return"Todos os per\xedodos";default:return"Per\xedodo selecionado"}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Resumo Financeiro"}),u&&(0,s.jsxs)(c.z,{onClick:u,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[m?(0,s.jsx)(N.Z,{className:"h-4 w-4"}):(0,s.jsx)(y.Z,{className:"h-4 w-4"}),m?"Mostrar Valores":"Ocultar Valores"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,s.jsx)(i.Zb,{className:"border-0 bg-gradient-to-br from-green-500 to-emerald-600 text-white shadow-lg",children:(0,s.jsxs)(i.aY,{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,s.jsx)(l.Z,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-sm font-medium opacity-90",children:"Receitas"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold",children:m?"••••••":(0,h.xG)(p.total.income)}),(0,s.jsx)("p",{className:"mt-1 text-xs opacity-75",children:f(o)})]})}),(0,s.jsx)(i.Zb,{className:"border-0 bg-gradient-to-br from-rose-500 to-red-600 text-white shadow-lg",children:(0,s.jsxs)(i.aY,{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,s.jsx)(w.Z,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-sm font-medium opacity-90",children:"Despesas"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold",children:m?"••••••":(0,h.xG)(p.total.expense)}),(0,s.jsx)("p",{className:"mt-1 text-xs opacity-75",children:f(o)})]})}),(0,s.jsx)(i.Zb,{className:"border-0 shadow-lg ".concat(p.total.balance>=0?"bg-gradient-to-br from-blue-500 to-indigo-600":"bg-gradient-to-br from-orange-500 to-red-600"," text-white"),children:(0,s.jsxs)(i.aY,{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,s.jsx)(D.Z,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-sm font-medium opacity-90",children:"Balan\xe7o"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold",children:m?"••••••":(0,h.xG)(p.total.balance)}),(0,s.jsx)("p",{className:"mt-1 text-xs opacity-75",children:p.total.balance>=0?"Positivo":"Negativo"})]})})]})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(c.z,{onClick:()=>g(!x),variant:"ghost",size:"sm",className:"p-1 h-auto",children:x?(0,s.jsx)(C.Z,{className:"h-4 w-4"}):(0,s.jsx)(_.Z,{className:"h-4 w-4"})}),(0,s.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,s.jsx)(S.Z,{className:"h-5 w-5"}),"Resumo por Conta"]})]}),(0,s.jsxs)(c.z,{onClick:()=>{window.open(d?"/transactions?account=".concat(d):"/transactions","_blank")},variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:"\uD83D\uDCCA"}),"Ver Hist\xf3rico"]})]})}),x&&(0,s.jsx)(i.aY,{children:(0,s.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.accounts.map(e=>(0,s.jsxs)("div",{className:"rounded-lg border p-4 hover:shadow-md transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:e.icon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500 capitalize",children:e.type})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-green-600",children:"Receitas:"}),(0,s.jsx)("span",{className:"font-medium",children:(0,h.xG)(e.income)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-red-600",children:"Despesas:"}),(0,s.jsx)("span",{className:"font-medium",children:(0,h.xG)(e.expense)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm border-t pt-2",children:[(0,s.jsx)("span",{className:"font-medium",children:"Balan\xe7o:"}),(0,s.jsx)("span",{className:"font-bold ".concat(e.balance>=0?"text-green-600":"text-red-600"),children:(0,h.xG)(e.balance)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,s.jsx)("span",{children:"Transa\xe7\xf5es:"}),(0,s.jsx)("span",{children:e.transactionCount})]})]})]},e.id))})})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Categorias"})}),(0,s.jsx)(i.aY,{children:(0,s.jsx)("div",{className:"space-y-3",children:p.topCategories.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:e.icon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium",children:e.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:[e.count," transa\xe7\xe3o",1!==e.count?"\xf5es":""]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"font-bold",children:(0,h.xG)(e.income+e.expense)}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"income"===e.type?"Receita":"Despesa"})]})]},e.id))})})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Estat\xedsticas"})}),(0,s.jsx)(i.aY,{children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:p.transactionCount}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Transa\xe7\xf5es"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:p.accounts.length}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Contas"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:p.topCategories.length}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Categorias"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-2xl font-bold ".concat(p.total.balance>=0?"text-green-600":"text-red-600"),children:p.total.balance>=0?"✅":"⚠️"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Status"})]})]})})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Top Categorias"})}),(0,s.jsx)(i.aY,{children:(0,s.jsx)("div",{className:"space-y-3",children:p.topCategories.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:e.icon}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium",children:e.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:[e.count," transa\xe7\xe3o",1!==e.count?"\xf5es":""]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"font-bold",children:(0,h.xG)(e.income+e.expense)}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"income"===e.type?"Receita":"Despesa"})]})]},e.id))})})]})]})}var k=a(35231),z=a(25974),Z=a(2842),T=a(9542),F=a(85475),I=a(45745);function B(e){let{transactions:t}=e,a=(0,n.useMemo)(()=>{let e=new Date,a=[];for(let s=9;s>=0;s--){let n=new Date(e.getFullYear(),e.getMonth()-s,1),r=n.getMonth()+1,l=n.getFullYear(),o=(0,h.XY)(r),i=t.filter(e=>{let t=new Date(e.transaction_date);return t.getFullYear()===l&&t.getMonth()+1===r&&"expense"===e.type}).reduce((e,t)=>e+Number(t.amount),0);a.push({month:o,amount:i,monthIndex:r})}return a},[t]);return a.map(e=>e.amount),(0,s.jsx)("div",{className:"h-64 w-full",children:(0,s.jsx)(k.h,{width:"100%",height:"100%",children:(0,s.jsxs)(z.v,{data:a,margin:{top:10,right:10,left:10,bottom:0},children:[(0,s.jsx)(Z.K,{dataKey:"month",stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1}),(0,s.jsx)(T.B,{stroke:"#64748b",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:e=>"".concat((e/1e3).toFixed(0),"k")}),(0,s.jsx)(F.u,{cursor:{fill:"rgba(148, 163, 184, 0.1)"},content:e=>{let{active:t,payload:a}=e;if(t&&a&&a.length){var n;return(0,s.jsx)("div",{className:"rounded-lg border bg-white p-2 shadow-lg",children:(0,s.jsxs)("p",{className:"text-sm font-semibold text-slate-900",children:[null===(n=a[0].value)||void 0===n?void 0:n.toLocaleString("sv-SE")," SEK"]})})}return null}}),(0,s.jsx)(I.$,{dataKey:"amount",fill:"url(#colorGradient)",radius:[8,8,0,0],maxBarSize:50}),(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:"colorGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:1}),(0,s.jsx)("stop",{offset:"100%",stopColor:"#60a5fa",stopOpacity:1})]})})]})})})}var R=a(23909),M=a(85369),O=a(68295),A=a(20153);function U(e){let{categories:t,transactions:a,type:n,title:r}=e,l=t.filter(e=>e.type===n).map(e=>{let t=a.filter(t=>t.category_id===e.id&&t.type===n).reduce((e,t)=>e+t.amount,0);return{name:e.name,value:t,color:e.color,icon:e.icon}}).filter(e=>e.value>0).sort((e,t)=>t.value-e.value),o=l.reduce((e,t)=>e+t.value,0);return 0===l.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-slate-200 p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:r}),(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsxs)("p",{className:"text-slate-500",children:["Nenhum ","income"===n?"ganho":"gasto"," encontrado para este per\xedodo"]})})]}):(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-slate-200 p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:r}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(k.h,{width:"100%",height:"100%",children:(0,s.jsxs)(R.u,{children:[(0,s.jsx)(M.b,{data:l,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"value",children:l.map((e,t)=>(0,s.jsx)(O.b,{fill:e.color},"cell-".concat(t)))}),(0,s.jsx)(F.u,{content:(0,s.jsx)(e=>{let{active:t,payload:a}=e;if(t&&a&&a.length){let e=a[0].payload,t=(e.value/o*100).toFixed(1);return(0,s.jsxs)("div",{className:"bg-white p-3 border border-slate-200 rounded-lg shadow-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"text-lg",children:e.icon}),(0,s.jsx)("span",{className:"font-semibold text-slate-900",children:e.name})]}),(0,s.jsxs)("div",{className:"text-sm text-slate-600",children:[(0,s.jsxs)("div",{children:["Valor:"," ",new Intl.NumberFormat("sv-SE",{style:"currency",currency:"SEK"}).format(e.value)]}),(0,s.jsxs)("div",{children:["Percentual: ",t,"%"]})]})]})}return null},{})}),(0,s.jsx)(A.D,{content:(0,s.jsx)(e=>{let{payload:t}=e;return(0,s.jsx)("div",{className:"flex flex-wrap gap-2 justify-center mt-4",children:null==t?void 0:t.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,s.jsx)("span",{className:"text-slate-700",children:e.value})]},t))})},{})})]})})}),(0,s.jsx)("div",{className:"mt-4 text-center",children:(0,s.jsxs)("p",{className:"text-sm text-slate-600",children:["Total:"," ",new Intl.NumberFormat("sv-SE",{style:"currency",currency:"SEK"}).format(o)]})})]})}var G=a(79745),Y=a(68954),L=a(52022),P=a(60994),V=a(74284),K=a(84415);function H(e){var t,a;let{accounts:r,categories:l,onTransactionCreated:i}=e,[d,m]=(0,n.useState)(!1),[u,x]=(0,n.useState)(""),[h,g]=(0,n.useState)([]),[p,j]=(0,n.useState)(!1),[b,v]=(0,n.useState)(!0),[N,y]=(0,n.useState)((null===(t=r[0])||void 0===t?void 0:t.id)||null),[w,D]=(0,n.useState)([]),[C,_]=(0,n.useState)(null),[S,E]=(0,n.useState)(""),k=(0,n.useRef)(null),{toast:z}=(0,K.pm)(),Z=(0,V.e)(),T=()=>{var e;null===(e=k.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{T()},[h]),(0,n.useEffect)(()=>{let e=localStorage.getItem("chat-messages");if(e){let t=JSON.parse(e).map(e=>({...e,timestamp:new Date(e.timestamp)}));g(t),v(0===t.length)}},[]);let F=async()=>{console.log("\uD83D\uDD04 Carregando transa\xe7\xf5es recentes..."),console.log("Accounts dispon\xedveis:",r);try{console.log("1. Tentando buscar todas as transa\xe7\xf5es...");let{data:e,error:t}=await Z.from("transactions").select("\n          id, type, amount, description, transaction_date, created_via,\n          category:categories(name, icon),\n          account:accounts(name, icon),\n          user:users(full_name)\n        ").order("transaction_date",{ascending:!1}).limit(10);if(console.log("Resultado da busca sem filtro:",{allTransactions:e,allError:t}),t){console.error("❌ Erro ao buscar todas as transa\xe7\xf5es:",t),D([]);return}if(e&&e.length>0){console.log("✅ Transa\xe7\xf5es encontradas:",e.length),D(e);return}if(r&&r.length>0){console.log("2. Tentando buscar com filtro de contas...");let e=r.map(e=>e.id);console.log("Account IDs para filtrar:",e);let{data:t,error:a}=await Z.from("transactions").select("\n            id, type, amount, description, transaction_date, created_via,\n            category:categories(name, icon),\n            account:accounts(name, icon),\n            user:users(full_name)\n          ").in("account_id",e).order("transaction_date",{ascending:!1}).limit(10);console.log("Resultado da busca com filtro:",{filteredTransactions:t,filteredError:a}),a?console.error("❌ Erro ao buscar transa\xe7\xf5es filtradas:",a):(console.log("✅ Transa\xe7\xf5es filtradas encontradas:",(null==t?void 0:t.length)||0),D(t||[]))}else console.log("⚠️ Nenhuma conta dispon\xedvel para filtrar"),D([])}catch(e){console.error("❌ Erro geral ao carregar transa\xe7\xf5es:",e),D([])}};(0,n.useEffect)(()=>{d&&(console.log("\uD83D\uDE80 Chat aberto, carregando transa\xe7\xf5es..."),F())},[d,r]),(0,n.useEffect)(()=>{console.log("\uD83D\uDCCA Estado recentTransactions atualizado:",w),console.log("\uD83D\uDCCA N\xfamero de transa\xe7\xf5es:",w.length)},[w]);let I=e=>{localStorage.setItem("chat-messages",JSON.stringify(e))},B=async e=>{let t=e.toLowerCase().trim();if("hist\xf3rico"===t||"historico"===t||"listar"===t){if(0===w.length)return{id:Date.now().toString(),text:"\uD83D\uDCCB Nenhuma transa\xe7\xe3o recente encontrada.",isUser:!1,timestamp:new Date,type:"response"};let e=w.slice(0,5).map((e,t)=>{var a;let s="income"===e.type?"\uD83D\uDCB0":"\uD83D\uDCB8",n=e.amount.toFixed(2),r=new Date(e.transaction_date).toLocaleDateString("pt-BR");return"".concat(t+1,". ").concat(s," ").concat(n," kr - ").concat((null===(a=e.category)||void 0===a?void 0:a.name)||"Sem categoria"," (").concat(r,")")}).join("\n");return{id:Date.now().toString(),text:"\uD83D\uDCCB **\xdaltimas 5 transa\xe7\xf5es:**\n\n".concat(e,'\n\n\uD83D\uDCA1 Use "editar 1" para editar a primeira transa\xe7\xe3o'),isUser:!1,timestamp:new Date,type:"response"}}let a=t.match(/editar\s+(\d+)/);if(a){let e=parseInt(a[1])-1;if(!(e>=0)||!(e<w.length))return{id:Date.now().toString(),text:"❌ Transa\xe7\xe3o n\xe3o encontrada. Use 'listar' para ver as transa\xe7\xf5es dispon\xedveis.",isUser:!1,timestamp:new Date,type:"response"};{var s;let t=w[e];return{id:Date.now().toString(),text:"✏️ **Editando transa\xe7\xe3o ".concat(e+1,":**\n\n").concat("income"===t.type?"\uD83D\uDCB0":"\uD83D\uDCB8"," ").concat(t.amount," kr - ").concat((null===(s=t.category)||void 0===s?void 0:s.name)||"Sem categoria",'\n\n\uD83D\uDCA1 Digite: "novo valor 150" ou "nova categoria mercado"'),isUser:!1,timestamp:new Date,type:"response",transactionId:t.id}}}let n=t.match(/deletar\s+(\d+)/);if(n){let e=parseInt(n[1])-1;if(!(e>=0)||!(e<w.length))return{id:Date.now().toString(),text:"❌ Transa\xe7\xe3o n\xe3o encontrada. Use 'listar' para ver as transa\xe7\xf5es dispon\xedveis.",isUser:!1,timestamp:new Date,type:"response"};{let t=w[e];try{let{error:a}=await Z.from("transactions").delete().eq("id",t.id);if(a)throw a;return await F(),null==i||i(),{id:Date.now().toString(),text:"\uD83D\uDDD1️ Transa\xe7\xe3o ".concat(e+1," deletada com sucesso!"),isUser:!1,timestamp:new Date,type:"response"}}catch(e){return{id:Date.now().toString(),text:"❌ Erro ao deletar transa\xe7\xe3o. Tente novamente.",isUser:!1,timestamp:new Date,type:"response"}}}}return null},R=(e,t)=>{var a;_(e),E(e.amount.toString());let s=[...h,{id:Date.now().toString(),text:"✏️ **Editando transa\xe7\xe3o ".concat(t+1,":**\n\n").concat("income"===e.type?"\uD83D\uDCB0":"\uD83D\uDCB8"," ").concat(e.amount," kr - ").concat((null===(a=e.category)||void 0===a?void 0:a.name)||"Sem categoria","\n\n\uD83D\uDCA1 Digite o novo valor e pressione Enter"),isUser:!1,timestamp:new Date,type:"response",transactionId:e.id}];g(s),I(s)},M=async()=>{if(!C||!S.trim())return;let e=parseFloat(S.replace(",","."));if(isNaN(e)||e<=0){z({variant:"destructive",title:"Erro",description:"Valor inv\xe1lido. Digite um n\xfamero maior que zero."});return}try{let{error:t}=await Z.from("transactions").update({amount:e}).eq("id",C.id);if(t)throw t;await F(),null==i||i();let a={id:Date.now().toString(),text:"✅ Transa\xe7\xe3o atualizada! Novo valor: ".concat(e.toFixed(2)," kr"),isUser:!1,timestamp:new Date,type:"response"},s=[...h,a];g(s),I(s),z({title:"Transa\xe7\xe3o atualizada!",description:"Valor alterado para ".concat(e.toFixed(2)," kr")}),_(null),E("")}catch(e){console.error("Erro ao atualizar transa\xe7\xe3o:",e),z({variant:"destructive",title:"Erro",description:"N\xe3o foi poss\xedvel atualizar a transa\xe7\xe3o."})}},O=e=>{console.log("Parsing text:",e.toLowerCase());let t=N,a=e;for(let s of[/(?:na\s+conta|conta)\s+(\w+)/i,/(?:usando|com)\s+a\s+conta\s+(\w+)/i]){let n=e.match(s);if(n){let l=n[1].toLowerCase(),o=r.find(e=>e.name.toLowerCase().includes(l)||l.includes(e.name.toLowerCase()));o&&(t=o.id,a=e.replace(s,"").trim(),console.log("Account specified:",o.name,"ID:",t))}}let s=a.toLowerCase();for(let e of[/(?:gasto|despesa|saída|saida)\s+(\w+)\s+(\d+(?:[.,]\d+)?)/i,/(?:compras|mercado|transporte|lazer|saúde|saude|restaurant|restaurante)\s+(\d+(?:[.,]\d+)?)/i,/(?:gasto|gastar)\s+(\d+(?:[.,]\d+)?)\s+(\w+)/i,/(?:gasto|gastar)\s+(\d+(?:[.,]\d+)?)/i]){let n=s.match(e);if(n){let e,s;if(console.log("Expense pattern match:",n),n[2]?(e=parseFloat(n[1].replace(",",".")),s=n[2]):(e=parseFloat(n[1].replace(",",".")),s="geral"),console.log("Extracted - amount:",e,"category:",s),!isNaN(e))return{type:"expense",amount:e,category:s.toLowerCase(),description:a,accountId:t}}}for(let e of[/(?:receita|entrada)\s+(\w+)\s+(\d+(?:[.,]\d+)?)/i,/(?:salário|salario|freelance|investimento)\s+(\d+(?:[.,]\d+)?)/i,/(?:add|adicionar)\s+(\d+(?:[.,]\d+)?)\s+(\w+)/i,/(?:add|adicionar)\s+(\d+(?:[.,]\d+)?)/i]){let n=s.match(e);if(n){let e,s;if(console.log("Income pattern match:",n),n[2]?(e=parseFloat(n[1].replace(",",".")),s=n[2]):(e=parseFloat(n[1].replace(",",".")),s="sal\xe1rio"),console.log("Extracted - amount:",e,"category:",s),!isNaN(e))return{type:"income",amount:e,category:s.toLowerCase(),description:a,accountId:t}}}return null},A=(e,t)=>{var a;for(let[a,s]of Object.entries({mercado:["mercado","compras","supermercado"],transporte:["transporte","gasolina","uber","taxi"],lazer:["lazer","cinema","restaurante","restaurant","bar"],saúde:["sa\xfade","saude","farmacia","medico"],salário:["sal\xe1rio","salario","salario"],freelance:["freelance","freela"],investimento:["investimento","renda"],geral:["geral","outros","diversos"]}))if(s.some(t=>e.includes(t))){let e=l.find(e=>e.name.toLowerCase().includes(a)&&e.type===t);if(e)return e.id}return null===(a=l.find(e=>e.type===t))||void 0===a?void 0:a.id},U=async()=>{if(!u.trim())return;let e=[...h,{id:Date.now().toString(),text:u,isUser:!0,timestamp:new Date}];g(e),I(e),x(""),j(!0),v(!1);try{if(C){let t=parseFloat(u.replace(",","."));if(!isNaN(t)&&t>0){E(u),await M(),j(!1);return}{let t={id:Date.now().toString(),text:"❌ Valor inv\xe1lido. Digite um n\xfamero maior que zero.",isUser:!1,timestamp:new Date,type:"response"},a=[...e,t];g(a),I(a),j(!1);return}}let t=await B(u);if(t){let a=[...e,t];g(a),I(a),j(!1);return}let a=O(u);if(!a){let t={id:(Date.now()+1).toString(),text:"N\xe3o consegui entender. Use:\n• 'gasto restaurant 100'\n• 'receita sal\xe1rio 5000'\n• 'listar' - ver hist\xf3rico\n• 'editar 1' - editar transa\xe7\xe3o\n• 'deletar 1' - deletar transa\xe7\xe3o",isUser:!1,timestamp:new Date,processed:!0,error:"Formato n\xe3o reconhecido"},a=[...e,t];g(a),I(a);return}let s=A(a.category,a.type);if(!s){let t={id:(Date.now()+1).toString(),text:"Categoria n\xe3o encontrada. Tente: mercado, transporte, lazer, etc.",isUser:!1,timestamp:new Date,processed:!0,error:"Categoria n\xe3o encontrada"},a=[...e,t];g(a),I(a);return}if(!r||0===r.length){let t={id:(Date.now()+1).toString(),text:"❌ Nenhuma conta encontrada. Crie uma conta primeiro em /accounts",isUser:!1,timestamp:new Date,processed:!0,error:"Nenhuma conta dispon\xedvel"},a=[...e,t];g(a),I(a);return}let n=a.accountId||r[0].id,l=r.find(e=>e.id===n),{data:o,error:c}=await Z.from("transactions").insert({type:a.type,amount:a.amount,category_id:s,account_id:n,description:a.description,transaction_date:new Date().toISOString().split("T")[0],created_via:"chat"}).select().single();if(c)throw c;let d={id:(Date.now()+1).toString(),text:"✅ ".concat("income"===a.type?"Receita":"Despesa"," de ").concat(a.amount.toFixed(2)," kr registrada na conta ").concat((null==l?void 0:l.name)||"Principal","!"),isUser:!1,timestamp:new Date,processed:!0,result:"Transa\xe7\xe3o criada com sucesso"},m=[...e,d];g(m),I(m),await F(),z({title:"Transa\xe7\xe3o criada!",description:"Chat: ".concat("income"===a.type?"Receita":"Despesa"," de ").concat(a.amount.toFixed(2)," kr")}),null==i||i()}catch(a){console.error("Erro ao criar transa\xe7\xe3o:",a);let t=[...e,{id:(Date.now()+1).toString(),text:"❌ Erro ao registrar transa\xe7\xe3o. Tente novamente.",isUser:!1,timestamp:new Date,processed:!0,error:"Erro no servidor"}];g(t),I(t)}finally{j(!1)}};return console.log("\uD83C\uDFAF FloatingChat renderizando...",{isOpen:d,accounts:null==r?void 0:r.length}),(0,s.jsxs)(s.Fragment,{children:[!d&&(0,s.jsx)(c.z,{onClick:()=>{m(!0)},className:"fixed bottom-6 right-6 h-14 w-14 rounded-full bg-green-500 hover:bg-green-600 shadow-lg z-50",size:"icon",children:(0,s.jsx)(o.Z,{className:"h-6 w-6 text-white"})}),d&&(0,s.jsxs)("div",{className:"fixed bottom-6 right-6 w-80 h-96 bg-white rounded-lg shadow-2xl border z-[9999] flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b bg-green-500 text-white rounded-t-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(Y.Z,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"font-medium",children:"FinControl Chat"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(c.z,{onClick:()=>{g([]),v(!0),localStorage.removeItem("chat-messages")},variant:"ghost",size:"sm",className:"text-white hover:bg-green-600",children:"Limpar"}),(0,s.jsx)(c.z,{onClick:()=>m(!1),variant:"ghost",size:"sm",className:"text-white hover:bg-green-600",children:(0,s.jsx)(f.Z,{className:"h-4 w-4"})})]})]}),r.length>1&&(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("span",{className:"text-green-100",children:"Conta padr\xe3o:"}),(0,s.jsx)("select",{value:N||"",onChange:e=>y(e.target.value),className:"ml-1 bg-green-600 text-white border-none rounded px-1 py-0.5 text-xs",children:r.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[b&&(0,s.jsxs)("div",{className:"text-center text-gray-500 text-sm",children:[(0,s.jsx)(Y.Z,{className:"h-8 w-8 mx-auto mb-2 text-green-500"}),(0,s.jsx)("p",{children:"Ol\xe1! Digite sua transa\xe7\xe3o ou comando:"}),(0,s.jsxs)("div",{className:"text-xs mt-2 space-y-1",children:[(0,s.jsx)("p",{className:"font-medium text-gray-700",children:"\uD83D\uDCB8 Transa\xe7\xf5es:"}),(0,s.jsx)("p",{children:"• gasto restaurant 100"}),(0,s.jsx)("p",{children:"• receita sal\xe1rio 5000"}),r.length>1&&(0,s.jsx)("p",{children:"• gasto mercado 50 na conta casa"}),(0,s.jsx)("p",{className:"font-medium text-gray-700 mt-2",children:"\uD83D\uDCCB Comandos:"}),(0,s.jsx)("p",{children:"• listar - ver hist\xf3rico"}),(0,s.jsx)("p",{children:"• editar 1 - editar transa\xe7\xe3o"}),(0,s.jsx)("p",{children:"• deletar 1 - deletar transa\xe7\xe3o"})]})]}),h.map(e=>(0,s.jsx)("div",{className:"flex ".concat(e.isUser?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"max-w-[80%] p-3 rounded-lg text-sm ".concat(e.isUser?"bg-green-500 text-white":"bg-gray-100 text-gray-800"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[e.isUser?(0,s.jsx)(L.Z,{className:"h-3 w-3"}):(0,s.jsx)(Y.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{className:"text-xs opacity-70",children:e.timestamp.toLocaleTimeString()})]}),(0,s.jsx)("div",{className:"whitespace-pre-line text-sm",children:e.text.split("\n").map((e,t)=>(0,s.jsx)("div",{children:e.includes("**")?(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}}):e},t))})]})},e.id)),p&&(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)("div",{className:"bg-gray-100 p-3 rounded-lg text-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(Y.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:"Processando..."})]})})}),(0,s.jsx)("div",{ref:k})]}),(console.log("\uD83C\uDFA8 Renderizando lista de transa\xe7\xf5es..."),console.log("\uD83C\uDFA8 recentTransactions.length:",w.length),console.log("\uD83C\uDFA8 recentTransactions:",w),null),0===w.length&&(0,s.jsx)("div",{className:"border-t bg-yellow-50 p-3 text-xs text-yellow-700",children:"\uD83D\uDD0D Debug: Nenhuma transa\xe7\xe3o encontrada. Verifique o console para logs."}),w.length>0&&(0,s.jsxs)("div",{className:"border-t bg-gray-50 p-3 max-h-32 overflow-y-auto",children:[(0,s.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"\uD83D\uDCCB \xdaltimas 5 transa\xe7\xf5es:"}),(0,s.jsx)("div",{className:"space-y-1",children:w.slice(0,5).map((e,t)=>{var a,n;return(0,s.jsxs)("div",{className:"flex items-center justify-between bg-white p-2 rounded text-xs border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"text-lg",children:"income"===e.type?"\uD83D\uDCB0":"\uD83D\uDCB8"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-medium truncate",children:(null===(a=e.category)||void 0===a?void 0:a.name)||"Sem categoria"}),(0,s.jsxs)("div",{className:"text-gray-500 truncate",children:[null===(n=e.account)||void 0===n?void 0:n.name," •"," ",new Date(e.transaction_date).toLocaleDateString("pt-BR")]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsxs)("span",{className:"font-bold ".concat("income"===e.type?"text-green-600":"text-red-600"),children:["income"===e.type?"+":"-",e.amount.toFixed(2)," kr"]}),(0,s.jsx)(c.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-gray-400 hover:text-blue-600",onClick:()=>R(e,t),children:"✏️"})]})]},e.id)})})]}),(0,s.jsxs)("div",{className:"p-4 border-t",children:[C&&(0,s.jsx)("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"text-blue-700",children:["✏️ Editando:"," ",(null===(a=C.category)||void 0===a?void 0:a.name)||"Sem categoria"," -"," ",C.amount," kr"]}),(0,s.jsx)(c.z,{size:"sm",variant:"ghost",className:"h-5 w-5 p-0 text-blue-600 hover:text-blue-800",onClick:()=>{_(null),E("")},children:"✕"})]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(G.I,{value:u,onChange:e=>x(e.target.value),placeholder:C?"Digite o novo valor...":"Ex: gasto restaurant 100",onKeyPress:e=>"Enter"===e.key&&U(),disabled:p,className:"flex-1"}),(0,s.jsx)(c.z,{onClick:U,disabled:p||!u.trim(),size:"icon",className:"bg-green-500 hover:bg-green-600",children:(0,s.jsx)(P.Z,{className:"h-4 w-4"})})]})]})]})]})}function Q(e){var t,a;let{isOpen:r,onClose:l,accounts:i,categories:h,onTransactionCreated:g}=e,[p,j]=(0,n.useState)(""),[b,v]=(0,n.useState)(!1),[N,y]=(0,n.useState)([]),[w,D]=(0,n.useState)(""),{toast:C}=(0,K.pm)(),_=(0,V.e)(),S=e=>{switch(e){case"personal":default:return(0,s.jsx)(d.Z,{className:"h-4 w-4"});case"shared":return(0,s.jsx)(m.Z,{className:"h-4 w-4"});case"business":return(0,s.jsx)(u.Z,{className:"h-4 w-4"});case"vehicle":return(0,s.jsx)(x.Z,{className:"h-4 w-4"})}};(0,n.useEffect)(()=>{i&&i.length>0&&!w&&D(i[0].id)},[i,w]);let E=async()=>{try{console.log("\uD83D\uDD04 Carregando transa\xe7\xf5es no SimpleChat...");let{data:e,error:t}=await _.from("transactions").select("\n          id, type, amount, description, transaction_date, created_via,\n          category:categories(name, icon),\n          account:accounts(name, icon),\n          user:users(full_name)\n        ").order("transaction_date",{ascending:!1}).limit(10);console.log("Transa\xe7\xf5es encontradas:",e),t?(console.error("Erro ao buscar transa\xe7\xf5es:",t),y([])):y(e||[])}catch(e){console.error("Erro geral:",e),y([])}};(0,n.useEffect)(()=>{r&&E()},[r]);let k=e=>{let t=e.toLowerCase(),a=w;for(let e of i)if(t.includes("conta ".concat(e.name.toLowerCase()))||t.includes("na conta ".concat(e.name.toLowerCase()))){a=e.id;break}let s=t.match(/(?:gasto|despesa)\s+(\w+)\s+(\d+(?:[.,]\d+)?)/),n=t.match(/(?:receita|entrada)\s+(\w+)\s+(\d+(?:[.,]\d+)?)/);return s?{type:"expense",amount:parseFloat(s[2].replace(",",".")),category:s[1],description:e,accountId:a}:n?{type:"income",amount:parseFloat(n[2].replace(",",".")),category:n[1],description:e,accountId:a}:null},z=(e,t)=>{var a;for(let[a,s]of Object.entries({mercado:["mercado","compras","supermercado"],transporte:["transporte","gasolina","uber","taxi"],lazer:["lazer","cinema","restaurante","restaurant","bar"],saúde:["sa\xfade","saude","farmacia","medico"],salário:["sal\xe1rio","salario"],freelance:["freelance","freela"]}))if(s.some(t=>e.includes(t))){let e=h.find(e=>e.name.toLowerCase().includes(a)&&e.type===t);if(e)return e.id}return null===(a=h.find(e=>e.type===t))||void 0===a?void 0:a.id},Z=async()=>{if(p.trim()){v(!0),console.log("\uD83D\uDCE4 Enviando mensagem:",p),console.log("\uD83D\uDCCA Dados dispon\xedveis:",{accounts:null==i?void 0:i.length,categories:null==h?void 0:h.length,selectedAccountId:w,message:p});try{let e=k(p);if(console.log("\uD83D\uDCDD Mensagem parseada:",e),!e){C({variant:"destructive",title:"Erro",description:"Formato n\xe3o reconhecido. Use: 'gasto mercado 100' ou 'receita sal\xe1rio 5000'"}),v(!1);return}let t=z(e.category,e.type);if(console.log("\uD83D\uDD0D Buscando categoria:",{categoryName:e.category,type:e.type,categoryId:t,availableCategories:h.map(e=>({name:e.name,type:e.type,id:e.id}))}),!t){console.error("❌ Categoria n\xe3o encontrada!"),C({variant:"destructive",title:"Erro",description:'Categoria "'.concat(e.category,'" n\xe3o encontrada. Categorias dispon\xedveis: ').concat(h.map(e=>e.name).join(", "))}),v(!1);return}if(!i||0===i.length){C({variant:"destructive",title:"Erro",description:"Nenhuma conta encontrada."}),v(!1);return}let{data:{user:a}}=await _.auth.getUser(),s={type:e.type,amount:e.amount,category_id:t,account_id:e.accountId||w,description:e.description,transaction_date:new Date().toISOString().split("T")[0],created_via:"chat",user_id:null==a?void 0:a.id};console.log("\uD83D\uDCBE Dados da transa\xe7\xe3o:",s);let{data:n,error:r}=await _.from("transactions").insert(s).select().single();if(console.log("\uD83D\uDCBE Resultado da inser\xe7\xe3o:"),console.log("  - Transaction:",n),console.log("  - Error:",r),r)throw console.error("❌ ERRO COMPLETO:",JSON.stringify(r,null,2)),console.error("❌ Erro ao inserir transa\xe7\xe3o:",r),console.error("❌ Detalhes do erro:",{message:r.message,code:r.code,details:r.details,hint:r.hint}),r;C({title:"Transa\xe7\xe3o criada!",description:"".concat("income"===e.type?"Receita":"Despesa"," de ").concat(e.amount.toFixed(2)," kr registrada!")}),j(""),await E(),g?g():window.location.reload()}catch(e){console.error("Erro ao criar transa\xe7\xe3o:",e),C({variant:"destructive",title:"Erro",description:"N\xe3o foi poss\xedvel criar a transa\xe7\xe3o."})}finally{v(!1)}}};return r?(0,s.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:99999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:(0,s.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"10px",width:"100%",maxWidth:"500px",maxHeight:"80vh",display:"flex",flexDirection:"column",boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-6 rounded-t-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 text-white",children:[(0,s.jsx)(o.Z,{size:24}),(0,s.jsx)("h2",{className:"text-xl font-bold",children:"FinControl Chat"})]}),(0,s.jsx)(c.z,{onClick:l,variant:"ghost",size:"sm",className:"text-white hover:bg-white/20",children:(0,s.jsx)(f.Z,{size:20})})]}),i&&i.length>1&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-white mb-2",children:"Conta padr\xe3o:"}),(0,s.jsx)("select",{value:w,onChange:e=>D(e.target.value),className:"w-full p-2 rounded-lg border-0 bg-white/90 text-gray-800 focus:ring-2 focus:ring-white/50",children:i.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))})]})]}),N.length>0&&(0,s.jsxs)("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:[(0,s.jsx)("h3",{className:"text-sm font-bold text-gray-700 mb-3 flex items-center gap-2",children:"\uD83D\uDCCB \xdaltimas 5 transa\xe7\xf5es:"}),(0,s.jsx)("div",{className:"max-h-40 overflow-y-auto space-y-2",children:N.slice(0,5).map((e,t)=>{var a,n,r;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-gray-200 hover:shadow-sm transition-shadow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-lg",children:"income"===e.type?"\uD83D\uDCB0":"\uD83D\uDCB8"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold text-sm text-gray-800",children:(null===(a=e.category)||void 0===a?void 0:a.name)||"Sem categoria"}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[S((null===(n=e.account)||void 0===n?void 0:n.type)||"personal"),null===(r=e.account)||void 0===r?void 0:r.name," •"," ",new Date(e.transaction_date).toLocaleDateString("pt-BR"),"chat"===e.created_via&&(0,s.jsx)("span",{className:"bg-green-100 text-green-700 px-1 rounded text-xs",children:"chat"})]})]})]}),(0,s.jsxs)("span",{className:"font-bold text-sm ".concat("income"===e.type?"text-green-600":"text-red-600"),children:["income"===e.type?"+":"-",e.amount.toFixed(2)," kr"]})]},e.id)})})]}),(0,s.jsxs)("div",{className:"p-6 bg-gray-50",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"\uD83D\uDCAC Digite sua transa\xe7\xe3o:"}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200 mb-3",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"\uD83D\uDCDD Exemplos:"}),(0,s.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[(0,s.jsxs)("p",{children:["•"," ",(0,s.jsx)("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"gasto mercado 100"})," ","- Despesa de 100 kr em mercado"]}),(0,s.jsxs)("p",{children:["•"," ",(0,s.jsx)("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"receita sal\xe1rio 5000"})," ","- Receita de 5000 kr de sal\xe1rio"]}),(0,s.jsxs)("p",{children:["•"," ",(0,s.jsx)("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"gasto restaurante 250 na conta casa"})," ","- Especificar conta"]}),(0,s.jsxs)("p",{children:["•"," ",(0,s.jsx)("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:"receita freelance 1200"})," ","- Receita de freelance"]})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(G.I,{value:p,onChange:e=>j(e.target.value),placeholder:"Ex: gasto mercado 100",onKeyPress:e=>"Enter"===e.key&&Z(),disabled:b,className:"flex-1 text-lg"}),(0,s.jsx)(c.z,{onClick:Z,disabled:b||!p.trim(),className:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 px-6",children:(0,s.jsx)(P.Z,{size:18})})]}),b&&(0,s.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-sm text-gray-600",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-500"}),"Processando transa\xe7\xe3o..."]}),w&&(0,s.jsxs)("div",{className:"mt-3 text-xs text-gray-500",children:["\uD83D\uDCA1 Conta padr\xe3o:"," ",null===(t=i.find(e=>e.id===w))||void 0===t?void 0:t.icon," ",null===(a=i.find(e=>e.id===w))||void 0===a?void 0:a.name]})]})]})}):null}var q=a(92940),J=a(36127),W=a(40933);function $(e){let{account:t,transactions:a,historicalTransactions:r,customSettings:o}=e;console.log("SpendingForecast - customSettings recebidas:",o),console.log("SpendingForecast - account:",t.name,t.id);let c=(0,n.useMemo)(()=>{let e=new Date,s=e.getMonth(),n=e.getFullYear(),l=a.filter(e=>e.account_id===t.id),i=r.filter(e=>e.account_id===t.id),c=l.filter(e=>{let t=new Date(e.transaction_date);return t.getMonth()===s&&t.getFullYear()===n&&"expense"===e.type}),d=c.reduce((e,t)=>e+Number(t.amount),0),m=new Date(n,s-6,1),u=i.filter(e=>{let t=new Date(e.transaction_date);return t>=m&&t<new Date(n,s,1)&&"expense"===e.type}),x=[];for(let e=0;e<6;e++){let t=new Date(n,s-6+e,1),a=new Date(n,s-5+e,0),r=u.filter(e=>{let s=new Date(e.transaction_date);return s>=t&&s<=a}).reduce((e,t)=>e+Number(t.amount),0);x.push(r)}let h=x.reduce((e,t)=>e+t,0)/6,g=0,p=!1;o&&o.monthly_budget?(g=o.monthly_budget,p=!0,console.log("Usando or\xe7amento personalizado:",g)):o&&"flexible"===o.budget_type&&o.auto_adjust?console.log("Usando m\xe9dia hist\xf3rica:",g=h||0):console.log("Usando m\xe9dia hist\xf3rica como fallback:",g=h||0);let f=g/4.33,j=new Date(e);j.setDate(e.getDate()-e.getDay()),j.setHours(0,0,0,0);let b=c.filter(e=>new Date(e.transaction_date)>=j).reduce((e,t)=>e+Number(t.amount),0),v=new Date(n,s+1,0).getDate()-e.getDate(),N=e.getDate(),y=Math.max(0,g-d),w="on-track",D=((null==o?void 0:o.alert_threshold)||80)/100*g;d>g?w="over-budget":d>D?w="over-budget":d<.7*g&&(w="under-budget");let C="low";return x.filter(e=>e>0).length>=4?C="high":x.filter(e=>e>0).length>=2&&(C="medium"),{monthlyEstimate:g,weeklyEstimate:f,currentWeekSpent:b,remainingThisMonth:y,daysRemaining:v,projectedMonthlyTotal:30/N*d,status:w,confidence:C,isUsingCustomBudget:p}},[t.id,a,r,o]);return(0,s.jsxs)(i.Zb,{className:"border-blue-200 bg-gradient-to-br from-blue-50 to-indigo-50",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsxs)(i.ll,{className:"flex items-center gap-2 text-blue-800",children:[(0,s.jsx)(S.Z,{className:"h-5 w-5"}),"Previs\xe3o de Gastos - ",t.name]})}),(0,s.jsxs)(i.aY,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(e=>{switch(e){case"on-track":return(0,s.jsx)(q.Z,{className:"h-5 w-5 text-green-600"});case"over-budget":return(0,s.jsx)(J.Z,{className:"h-5 w-5 text-red-600"});case"under-budget":return(0,s.jsx)(l.Z,{className:"h-5 w-5 text-blue-600"});default:return(0,s.jsx)(W.Z,{className:"h-5 w-5 text-gray-600"})}})(c.status),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Status do Or\xe7amento"}),(0,s.jsxs)("p",{className:"text-sm ".concat((e=>{switch(e){case"on-track":return"text-green-600";case"over-budget":return"text-red-600";case"under-budget":return"text-blue-600";default:return"text-gray-600"}})(c.status)),children:["on-track"===c.status&&"No prazo","over-budget"===c.status&&"Acima do or\xe7amento","under-budget"===c.status&&"Abaixo do or\xe7amento"]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Confian\xe7a"}),(0,s.jsx)("p",{className:"text-sm font-medium",children:(e=>{switch(e){case"high":return"Alta confian\xe7a";case"medium":return"M\xe9dia confian\xe7a";case"low":return"Baixa confian\xe7a";default:return"Indispon\xedvel"}})(c.confidence)})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-white rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(j.Z,{className:"h-4 w-4 text-blue-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:c.isUsingCustomBudget?"Or\xe7amento Mensal":"Gasto Estimado/M\xeas"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:(0,h.xG)(c.monthlyEstimate)}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:c.isUsingCustomBudget?"Valor definido por voc\xea":"Baseado nos \xfaltimos 6 meses"})]}),(0,s.jsxs)("div",{className:"p-4 bg-white rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(W.Z,{className:"h-4 w-4 text-orange-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Gasto Esta Semana"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:(0,h.xG)(c.currentWeekSpent)}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Estimativa: ",(0,h.xG)(c.weeklyEstimate)]})]}),(0,s.jsxs)("div",{className:"p-4 bg-white rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(D.Z,{className:"h-4 w-4 text-green-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Restante Este M\xeas"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold ".concat(c.remainingThisMonth>0?"text-green-600":"text-red-600"),children:(0,h.xG)(c.remainingThisMonth)}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[c.daysRemaining," dias restantes"]})]}),(0,s.jsxs)("div",{className:"p-4 bg-white rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4 text-purple-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Proje\xe7\xe3o Mensal"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:(0,h.xG)(c.projectedMonthlyTotal)}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Baseado no ritmo atual"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{children:"Progresso do M\xeas"}),(0,s.jsxs)("span",{children:[Math.round(c.currentWeekSpent/c.monthlyEstimate*100),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,s.jsx)("div",{className:"h-3 rounded-full transition-all duration-300 ".concat("over-budget"===c.status?"bg-red-500":"under-budget"===c.status?"bg-blue-500":"bg-green-500"),style:{width:"".concat(Math.min(100,c.currentWeekSpent/c.monthlyEstimate*100),"%")}})}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,s.jsxs)("span",{children:["Gasto atual: ",(0,h.xG)(c.currentWeekSpent)]}),(0,s.jsxs)("span",{children:["Meta mensal: ",(0,h.xG)(c.monthlyEstimate)]})]})]}),"over-budget"===c.status&&(0,s.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(J.Z,{className:"h-4 w-4 text-red-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-red-800",children:"Aten\xe7\xe3o"})]}),(0,s.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"Voc\xea est\xe1 gastando acima da sua m\xe9dia hist\xf3rica. Considere revisar seus gastos."})]}),"under-budget"===c.status&&(0,s.jsxs)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(q.Z,{className:"h-4 w-4 text-blue-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"Bom trabalho!"})]}),(0,s.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"Voc\xea est\xe1 gastando abaixo da sua m\xe9dia. Continue assim!"})]})]})]})}function X(e){var t,a;let{user:d,accounts:m,categories:u,transactions:x,historicalTransactions:p}=e,[f,j]=(0,n.useState)((null===(t=m[0])||void 0===t?void 0:t.id)||null),[b,N]=(0,n.useState)(!1),[y,w]=(0,n.useState)(!0),{settings:D}=function(e){let[t,a]=(0,n.useState)(null),[s,r]=(0,n.useState)(!0),[l,o]=(0,n.useState)(null),i=(0,V.e)();(0,n.useEffect)(()=>{e&&c()},[e]);let c=async()=>{try{r(!0),o(null),console.log("\uD83D\uDD0D Carregando configura\xe7\xf5es para conta:",e);let{data:t,error:s}=await i.from("account_forecast_settings").select("*").eq("account_id",e).single();if(t&&!s){console.log("✅ Configura\xe7\xf5es encontradas no banco de dados:",t),a({monthly_budget:t.monthly_budget,alert_threshold:t.alert_threshold||80,budget_type:t.budget_type||"flexible",auto_adjust:t.auto_adjust||!0,notifications_enabled:t.notifications_enabled||!0}),r(!1);return}s&&"PGRST116"!==s.code?console.log("❌ Erro ao buscar no banco:",s.message):console.log("\uD83D\uDCDD Nenhuma configura\xe7\xe3o encontrada no banco de dados");let n="forecast_settings_".concat(e);console.log("\uD83D\uDD04 Tentando localStorage com chave:",n);let l=localStorage.getItem(n);if(l){let e=JSON.parse(l);console.log("✅ Configura\xe7\xf5es encontradas no localStorage:",e),a({monthly_budget:e.monthly_budget,alert_threshold:e.alert_threshold||80,budget_type:e.budget_type||"flexible",auto_adjust:void 0===e.auto_adjust||e.auto_adjust,notifications_enabled:void 0===e.notifications_enabled||e.notifications_enabled}),r(!1);return}console.log("\uD83D\uDCDD Usando configura\xe7\xf5es padr\xe3o"),a({monthly_budget:null,alert_threshold:80,budget_type:"flexible",auto_adjust:!0,notifications_enabled:!0})}catch(e){console.error("❌ Erro ao carregar configura\xe7\xf5es:",e),o(e instanceof Error?e.message:"Erro desconhecido")}finally{r(!1)}},d=async s=>{try{o(null),console.log("\uD83D\uDCBE Salvando configura\xe7\xf5es para conta:",e,s),a(e=>e?{...e,...s}:null);try{let{error:t}=await i.from("account_forecast_settings").upsert({account_id:e,...s,updated_at:new Date().toISOString()});if(t)throw console.log("❌ Erro ao salvar no banco:",t.message),t;console.log("✅ Configura\xe7\xf5es salvas no banco de dados com sucesso")}catch(r){console.log("\uD83D\uDD04 Erro ao salvar no banco, usando localStorage:",r);let a="forecast_settings_".concat(e),n={...t,...s};localStorage.setItem(a,JSON.stringify(n)),console.log("✅ Configura\xe7\xf5es salvas no localStorage como fallback")}return{success:!0}}catch(e){return console.error("❌ Erro ao atualizar configura\xe7\xf5es:",e),o(e instanceof Error?e.message:"Erro desconhecido"),{success:!1,error:e}}};return{settings:t,isLoading:s,error:l,updateSettings:d,refetch:c}}(f||""),[C,_]=(0,n.useState)({accountId:null,categoryId:null,period:"current-month",type:null});console.log("\uD83C\uDFAF Dashboard renderizando...",{accounts:null==m?void 0:m.length,isSimpleChatOpen:b,transactions:null==x?void 0:x.length,historicalTransactions:null==p?void 0:p.length,user:null==d?void 0:d.email}),console.log("\uD83D\uDCE5 Props recebidos pelo Dashboard:",{accounts:null==m?void 0:m.map(e=>({id:e.id,name:e.name,user_id:e.user_id})),transactions:null==x?void 0:x.map(e=>({id:e.id,type:e.type,amount:e.amount,account_id:e.account_id,transaction_date:e.transaction_date})),categories:null==u?void 0:u.length,user:{id:null==d?void 0:d.id,email:null==d?void 0:d.email}}),x&&x.length>0?console.log("\uD83D\uDCCA Transa\xe7\xf5es no dashboard:",x.map(e=>{var t;return{id:e.id,type:e.type,amount:e.amount,account:null===(t=e.account)||void 0===t?void 0:t.name,date:e.transaction_date}})):console.log("⚠️ Nenhuma transa\xe7\xe3o encontrada no dashboard"),(0,n.useEffect)(()=>{m.length>0&&!f&&j(m[0].id)},[m,f]);let S=e=>{let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0);switch(e){case"current-month":return{start:a,end:s};case"last-month":return{start:new Date(t.getFullYear(),t.getMonth()-1,1),end:new Date(t.getFullYear(),t.getMonth(),0)};case"last-3-months":return{start:new Date(t.getFullYear(),t.getMonth()-3,1),end:s};case"last-6-months":return{start:new Date(t.getFullYear(),t.getMonth()-6,1),end:s};case"current-year":return{start:new Date(t.getFullYear(),0,1),end:new Date(t.getFullYear(),11,31)};default:return{start:null,end:null}}},k=(0,n.useMemo)(()=>{console.log("\uD83D\uDD0D Aplicando filtros avan\xe7ados:",{filters:C,totalTransactions:null==x?void 0:x.length});let e=[...x];if(C.accountId?e=e.filter(e=>e.account_id===C.accountId):f&&(e=e.filter(e=>e.account_id===f)),C.categoryId&&(e=e.filter(e=>e.category_id===C.categoryId)),C.type&&(e=e.filter(e=>e.type===C.type)),"all"!==C.period){let{start:t,end:a}=S(C.period);t&&a&&(e=e.filter(e=>{let s=new Date(e.transaction_date);return s>=t&&s<=a}))}return console.log("✅ Transa\xe7\xf5es filtradas:",{filteredCount:e.length,filters:C}),e},[x,C,f]),z=(0,n.useMemo)(()=>f?p.filter(e=>e.account_id===f):p,[p,f]),{totalIncome:Z,totalExpense:T}=(0,n.useMemo)(()=>{console.log("\uD83D\uDCB0 Calculando totais:",{filteredTransactionsCount:null==k?void 0:k.length,filteredTransactions:null==k?void 0:k.map(e=>({id:e.id,type:e.type,amount:e.amount}))});let e=k.filter(e=>"income"===e.type),t=k.filter(e=>"expense"===e.type);console.log("\uD83D\uDCC8 Transa\xe7\xf5es de receita:",e.map(e=>({id:e.id,amount:e.amount}))),console.log("\uD83D\uDCC9 Transa\xe7\xf5es de despesa:",t.map(e=>({id:e.id,amount:e.amount})));let a=e.reduce((e,t)=>e+Number(t.amount),0),s=t.reduce((e,t)=>e+Number(t.amount),0);return console.log("\uD83D\uDCB5 Totais calculados:",{totalIncome:a,totalExpense:s,balance:a-s}),{totalIncome:a,totalExpense:s}},[k]);(0,n.useMemo)(()=>{let e=k.filter(e=>"expense"===e.type),t=new Map;return e.forEach(e=>{if(e.category){let a=t.get(e.category_id)||{amount:0,category:e.category};t.set(e.category_id,{amount:a.amount+Number(e.amount),category:e.category})}}),Array.from(t.values()).map(e=>({...e.category,amount:e.amount,percentage:T>0?Math.round(e.amount/T*100):0})).sort((e,t)=>t.amount-e.amount)},[k,T]);let F=(0,n.useMemo)(()=>0===p.length?0:p.reduce((e,t)=>e+Number(t.amount),0)/10,[p]);return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100",children:[(0,s.jsx)("div",{className:"sticky top-0 z-50 border-b bg-white/95 backdrop-blur-sm shadow-sm",children:(0,s.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"Dashboard"}),(0,s.jsxs)("p",{className:"text-sm text-slate-600",children:["Ol\xe1, ",(null===(a=d.user_metadata)||void 0===a?void 0:a.full_name)||d.email]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(c.z,{onClick:()=>{console.log("\uD83D\uDD04 For\xe7ando atualiza\xe7\xe3o do dashboard..."),window.location.reload()},variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,s.jsx)(r.Z,{className:"h-4 w-4"}),"Atualizar"]}),(0,s.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 text-2xl shadow-lg",children:"\uD83D\uDCB0"})]})]}),(0,s.jsx)(g,{accounts:m,activeAccountId:f,onAccountChange:j})]})}),(0,s.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-6",children:[(0,s.jsx)(v,{accounts:m,categories:u,onFiltersChange:_,activeFilters:C}),(0,s.jsx)(E,{transactions:k,accounts:m,categories:u,period:C.period,activeAccountId:f,hideValues:y,onToggleHideValues:()=>w(!y)}),f&&(0,s.jsx)($,{account:m.find(e=>e.id===f),transactions:k,historicalTransactions:z,customSettings:D||void 0}),(0,s.jsxs)(i.Zb,{className:"mb-6",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Gastos Mensais"})}),(0,s.jsx)(i.aY,{children:(0,s.jsx)(B,{transactions:z})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6",children:[(0,s.jsx)(U,{categories:u,transactions:k,type:"expense",title:"Gastos por Categoria"}),(0,s.jsx)(U,{categories:u,transactions:k,type:"income",title:"Ganhos por Categoria"})]}),(0,s.jsx)(i.Zb,{className:"mb-6 border-blue-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:(0,s.jsx)(i.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-1 text-sm text-slate-600",children:"Gasto m\xe9dio mensal"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-slate-800",children:(0,h.xG)(F)})]}),(0,s.jsx)("div",{className:"flex h-14 w-14 items-center justify-center rounded-full bg-blue-500",children:(0,s.jsx)(l.Z,{className:"h-7 w-7 text-white"})})]})})})]}),(0,s.jsx)(H,{accounts:m,categories:u,onTransactionCreated:()=>{console.log("\uD83D\uDD04 Recarregando dashboard ap\xf3s cria\xe7\xe3o de transa\xe7\xe3o..."),window.location.reload()}}),(0,s.jsx)(c.z,{onClick:()=>{console.log("\uD83D\uDFE2 BOT\xc3O DE CHAT CLICADO!"),N(!0)},className:"fixed bottom-6 right-6 h-16 w-16 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 shadow-2xl z-[9999] border-4 border-white hover:scale-110 transition-all duration-200",size:"icon",children:(0,s.jsx)(o.Z,{className:"h-8 w-8 text-white"})}),(0,s.jsx)(Q,{isOpen:b,onClose:()=>N(!1),accounts:m,categories:u,onTransactionCreated:()=>{window.location.reload()}})]})}},21018:function(e,t,a){"use strict";a.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},eW:function(){return m},ll:function(){return i}});var s=a(57437),n=a(2265),r=a(7880);let l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...n})});l.displayName="Card";let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",a),...n})});o.displayName="CardHeader";let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",a),...n})});i.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("p",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",a),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",a),...n})});d.displayName="CardContent";let m=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",a),...n})});m.displayName="CardFooter"},79745:function(e,t,a){"use strict";a.d(t,{I:function(){return l}});var s=a(57437),n=a(2265),r=a(7880);let l=n.forwardRef((e,t)=>{let{className:a,type:n,...l}=e;return(0,s.jsx)("input",{type:n,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...l})});l.displayName="Input"},77536:function(e,t,a){"use strict";a.d(t,{Bw:function(){return g},Ph:function(){return d},Ql:function(){return p},i4:function(){return u},ki:function(){return m}});var s=a(57437),n=a(2265),r=a(15280),l=a(42421),o=a(14392),i=a(22468),c=a(7880);let d=r.fC;r.ZA;let m=r.B4,u=n.forwardRef((e,t)=>{let{className:a,children:n,...o}=e;return(0,s.jsxs)(r.xz,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...o,children:[n,(0,s.jsx)(r.JO,{asChild:!0,children:(0,s.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=r.xz.displayName;let x=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...n,children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})});x.displayName=r.u_.displayName;let h=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...n,children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})})});h.displayName=r.$G.displayName;let g=n.forwardRef((e,t)=>{let{className:a,children:n,position:l="popper",...o}=e;return(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...o,children:[(0,s.jsx)(x,{}),(0,s.jsx)(r.l_,{className:(0,c.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,s.jsx)(h,{})]})})});g.displayName=r.VY.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...n})}).displayName=r.__.displayName;let p=n.forwardRef((e,t)=>{let{className:a,children:n,...l}=e;return(0,s.jsxs)(r.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(r.wU,{children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(r.eT,{children:n})]})});p.displayName=r.ck.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...n})}).displayName=r.Z0.displayName}},function(e){e.O(0,[136,231,955,504,824,156,149,542,971,23,744],function(){return e(e.s=26815)}),_N_E=e.O()}]);