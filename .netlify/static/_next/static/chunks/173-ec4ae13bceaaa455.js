(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{69177:function(e,t,r){Promise.resolve().then(r.bind(r,9592)),Promise.resolve().then(r.bind(r,69658))},69658:function(e,t,r){"use strict";r.d(t,{default:function(){return f}});var a=r(57437),n=r(2265),s=r(92595),o=r(81973),i=r(34029),c=r(82718),l=r(44743),d=r(41671);let u=(0,r(43664).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var m=r(58113),p=r(18420);function f(e){let{accounts:t,categories:r,onTransactionCreated:f}=e,[y,h]=(0,n.useState)(""),[x,g]=(0,n.useState)([]),[v,k]=(0,n.useState)(!1),{toast:w}=(0,p.pm)(),N=(0,m.e)(),j=e=>{let t=e.toLowerCase();for(let r of(console.log("Parsing text:",t),[/(?:gasto|despesa|saída|saida)\s+(\w+)\s+(\d+(?:[.,]\d+)?)/i,/(?:compras|mercado|transporte|lazer|saúde|saude)\s+(\d+(?:[.,]\d+)?)/i])){let a=t.match(r);if(a){console.log("Expense pattern match:",a);let t=parseFloat(a[2]||a[1].replace(",",".")),r=a[1];if(console.log("Extracted - amount:",t,"category:",r),!isNaN(t))return{type:"expense",amount:t,category:r.toLowerCase(),description:e}}}for(let r of[/(?:receita|entrada)\s+(\w+)\s+(\d+(?:[.,]\d+)?)/i,/(?:salário|salario|freelance|investimento)\s+(\d+(?:[.,]\d+)?)/i]){let a=t.match(r);if(a){console.log("Income pattern match:",a);let t=parseFloat(a[2]||a[1].replace(",",".")),r=a[1];if(console.log("Extracted - amount:",t,"category:",r),!isNaN(t))return{type:"income",amount:t,category:r.toLowerCase(),description:e}}}return console.log("No pattern matched"),null},Z=(e,t)=>{for(let[a,n]of(console.log("Looking for category:",e,"type:",t),Object.entries({mercado:["mercado","compras","supermercado"],transporte:["transporte","gasolina","uber","taxi"],lazer:["lazer","cinema","restaurante","bar"],saúde:["sa\xfade","saude","farmacia","medico"],salário:["sal\xe1rio","salario","salario"],freelance:["freelance","freela"],investimento:["investimento","renda"]})))if(n.some(t=>e.includes(t))){let e=r.find(e=>e.name.toLowerCase().includes(a)&&e.type===t);if(e)return console.log("Found category by mapping:",e),e.id}let a=r.find(r=>r.name.toLowerCase().includes(e)&&r.type===t);if(a)return console.log("Found category by name:",a),a.id;let n=r.find(e=>e.type===t);return console.log("Using fallback category:",n),null==n?void 0:n.id},b=async()=>{if(!y.trim())return;let e={id:Date.now().toString(),text:y,timestamp:new Date,processed:!1};g(t=>[...t,e]),k(!0);try{var a,n;let s=j(y);if(console.log("Parsed message:",s),!s){g(t=>t.map(t=>t.id===e.id?{...t,processed:!0,error:"N\xe3o consegui entender a mensagem. Use: 'gasto mercado 100' ou 'receita sal\xe1rio 5000'"}:t));return}let o=Z(s.category,s.type);if(console.log("Category ID found:",o,"for category:",s.category,"type:",s.type),console.log("Available categories:",r),!o){g(t=>t.map(t=>t.id===e.id?{...t,processed:!0,error:"Categoria n\xe3o encontrada"}:t));return}let{data:{user:i}}=await N.auth.getUser();console.log("Creating transaction with data:",{type:s.type,amount:s.amount,category_id:o,account_id:null===(a=t[0])||void 0===a?void 0:a.id,description:s.description,transaction_date:new Date().toISOString().split("T")[0],created_via:"whatsapp",user_id:null==i?void 0:i.id});let{data:c,error:l}=await N.from("transactions").insert({type:s.type,amount:s.amount,category_id:o,account_id:null===(n=t[0])||void 0===n?void 0:n.id,description:s.description,transaction_date:new Date().toISOString().split("T")[0],created_via:"whatsapp",user_id:null==i?void 0:i.id}).select().single();if(l)throw console.error("Supabase error:",l),l;g(t=>t.map(t=>t.id===e.id?{...t,processed:!0,result:"✅ Transa\xe7\xe3o criada: ".concat("income"===s.type?"Receita":"Despesa"," de ").concat(s.amount.toFixed(2)," kr")}:t)),w({title:"Transa\xe7\xe3o criada!",description:"WhatsApp: ".concat("income"===s.type?"Receita":"Despesa"," de ").concat(s.amount.toFixed(2)," kr")}),null==f||f()}catch(t){console.error("Erro ao criar transa\xe7\xe3o:",t),g(t=>t.map(t=>t.id===e.id?{...t,processed:!0,error:"Erro ao criar transa\xe7\xe3o"}:t))}finally{k(!1),h("")}};return(0,a.jsxs)(i.Zb,{className:"w-full max-w-md",children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 text-green-600"}),"WhatsApp Chat"]})}),(0,a.jsxs)(i.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.I,{value:y,onChange:e=>h(e.target.value),placeholder:"Ex: gasto mercado 100",onKeyPress:e=>"Enter"===e.key&&b(),disabled:v}),(0,a.jsx)(s.z,{onClick:b,disabled:v||!y.trim(),size:"icon",children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})]}),(0,a.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:x.map(e=>(0,a.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,a.jsx)("div",{className:"flex items-start gap-2",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.text}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.timestamp.toLocaleTimeString()}),e.processed&&(0,a.jsx)("div",{className:"mt-2 flex items-center gap-1",children:e.result?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)("span",{className:"text-sm text-green-600",children:e.result})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{className:"h-4 w-4 text-red-600"}),(0,a.jsx)("span",{className:"text-sm text-red-600",children:e.error})]})})]})})},e.id))}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsx)("p",{className:"font-medium",children:"Exemplos:"}),(0,a.jsx)("p",{children:"• gasto mercado 150"}),(0,a.jsx)("p",{children:"• receita sal\xe1rio 5000"}),(0,a.jsx)("p",{children:"• despesa transporte 50"})]})]})]})}},34029:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return l},Zb:function(){return o},aY:function(){return d},eW:function(){return u},ll:function(){return c}});var a=r(57437),n=r(2265),s=r(22835);let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...n})});o.displayName="Card";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...n})});i.displayName="CardHeader";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("h3",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",r),...n})});c.displayName="CardTitle";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...n})});l.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...n})});d.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...n})});u.displayName="CardFooter"},43664:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(2265),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=(e,t)=>{let r=(0,a.forwardRef)((r,o)=>{let{color:i="currentColor",size:c=24,strokeWidth:l=2,absoluteStrokeWidth:d,className:u="",children:m,...p}=r;return(0,a.createElement)("svg",{ref:o,...n,width:c,height:c,stroke:i,strokeWidth:d?24*Number(l)/Number(c):l,className:["lucide","lucide-".concat(s(e)),u].join(" "),...p},[...t.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(m)?m:[m]])});return r.displayName="".concat(e),r}},41671:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},88226:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},92735:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},99637:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},25466:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},47692:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},58293:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]])},82718:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},99397:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},44743:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},32489:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(43664).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},27648:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var a=r(72972),n=r.n(a)},99376:function(e,t,r){"use strict";var a=r(35475);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})}}]);