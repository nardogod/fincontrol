(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{69177:function(e,t,a){Promise.resolve().then(a.bind(a,9592)),Promise.resolve().then(a.bind(a,69658))},69658:function(e,t,a){"use strict";a.d(t,{default:function(){return y}});var r=a(57437),s=a(2265),n=a(92595),o=a(81973),i=a(34029),c=a(82718),l=a(44743),d=a(41671);let u=(0,a(43664).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var p=a(58113),m=a(18420);function y(e){let{accounts:t,categories:a,onTransactionCreated:y}=e,[h,g]=(0,s.useState)(""),[f,x]=(0,s.useState)([]),[k,v]=(0,s.useState)(!1),{toast:w}=(0,m.pm)(),j=(0,p.e)(),N=e=>{let t=e.toLowerCase();for(let a of(console.log("Parsing text:",t),[/(?:gasto|despesa|saída|saida)\s+(\w+)\s+(\d+(?:[.,]\d+)?)/i,/(?:compras|mercado|transporte|lazer|saúde|saude)\s+(\d+(?:[.,]\d+)?)/i])){let r=t.match(a);if(r){console.log("Expense pattern match:",r);let t=parseFloat(r[2]||r[1].replace(",",".")),a=r[1];if(console.log("Extracted - amount:",t,"category:",a),!isNaN(t))return{type:"expense",amount:t,category:a.toLowerCase(),description:e}}}for(let a of[/(?:receita|entrada)\s+(\w+)\s+(\d+(?:[.,]\d+)?)/i,/(?:salário|salario|freelance|investimento)\s+(\d+(?:[.,]\d+)?)/i]){let r=t.match(a);if(r){console.log("Income pattern match:",r);let t=parseFloat(r[2]||r[1].replace(",",".")),a=r[1];if(console.log("Extracted - amount:",t,"category:",a),!isNaN(t))return{type:"income",amount:t,category:a.toLowerCase(),description:e}}}return console.log("No pattern matched"),null},Z=(e,t)=>{for(let[r,s]of(console.log("Looking for category:",e,"type:",t),Object.entries({mercado:["mercado","compras","supermercado"],transporte:["transporte","gasolina","uber","taxi"],lazer:["lazer","cinema","restaurante","bar"],saúde:["sa\xfade","saude","farmacia","medico"],salário:["sal\xe1rio","salario","salario"],freelance:["freelance","freela"],investimento:["investimento","renda"]})))if(s.some(t=>e.includes(t))){let e=a.find(e=>e.name.toLowerCase().includes(r)&&e.type===t);if(e)return console.log("Found category by mapping:",e),e.id}let r=a.find(a=>a.name.toLowerCase().includes(e)&&a.type===t);if(r)return console.log("Found category by name:",r),r.id;let s=a.find(e=>e.type===t);return console.log("Using fallback category:",s),null==s?void 0:s.id},b=async()=>{if(!h.trim())return;let e={id:Date.now().toString(),text:h,timestamp:new Date,processed:!1};x(t=>[...t,e]),v(!0);try{var r,s;let n=N(h);if(console.log("Parsed message:",n),!n){x(t=>t.map(t=>t.id===e.id?{...t,processed:!0,error:"N\xe3o consegui entender a mensagem. Use: 'gasto mercado 100' ou 'receita sal\xe1rio 5000'"}:t));return}let o=Z(n.category,n.type);if(console.log("Category ID found:",o,"for category:",n.category,"type:",n.type),console.log("Available categories:",a),!o){x(t=>t.map(t=>t.id===e.id?{...t,processed:!0,error:"Categoria n\xe3o encontrada"}:t));return}let{data:{user:i}}=await j.auth.getUser();console.log("Creating transaction with data:",{type:n.type,amount:n.amount,category_id:o,account_id:null===(r=t[0])||void 0===r?void 0:r.id,description:n.description,transaction_date:new Date().toISOString().split("T")[0],created_via:"whatsapp",user_id:null==i?void 0:i.id});let{data:c,error:l}=await j.from("transactions").insert({type:n.type,amount:n.amount,category_id:o,account_id:null===(s=t[0])||void 0===s?void 0:s.id,description:n.description,transaction_date:new Date().toISOString().split("T")[0],created_via:"whatsapp",user_id:null==i?void 0:i.id}).select().single();if(l)throw console.error("Supabase error:",l),l;x(t=>t.map(t=>t.id===e.id?{...t,processed:!0,result:"✅ Transa\xe7\xe3o criada: ".concat("income"===n.type?"Receita":"Despesa"," de ").concat(n.amount.toFixed(2)," kr")}:t)),w({title:"Transa\xe7\xe3o criada!",description:"WhatsApp: ".concat("income"===n.type?"Receita":"Despesa"," de ").concat(n.amount.toFixed(2)," kr")}),null==y||y()}catch(t){console.error("Erro ao criar transa\xe7\xe3o:",t),x(t=>t.map(t=>t.id===e.id?{...t,processed:!0,error:"Erro ao criar transa\xe7\xe3o"}:t))}finally{v(!1),g("")}};return(0,r.jsxs)(i.Zb,{className:"w-full max-w-md",children:[(0,r.jsx)(i.Ol,{children:(0,r.jsxs)(i.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(c.Z,{className:"h-5 w-5 text-green-600"}),"WhatsApp Chat"]})}),(0,r.jsxs)(i.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(o.I,{value:h,onChange:e=>g(e.target.value),placeholder:"Ex: gasto mercado 100",onKeyPress:e=>"Enter"===e.key&&b(),disabled:k}),(0,r.jsx)(n.z,{onClick:b,disabled:k||!h.trim(),size:"icon",children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:f.map(e=>(0,r.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg",children:(0,r.jsx)("div",{className:"flex items-start gap-2",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:e.text}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:e.timestamp.toLocaleTimeString()}),e.processed&&(0,r.jsx)("div",{className:"mt-2 flex items-center gap-1",children:e.result?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 text-green-600"}),(0,r.jsx)("span",{className:"text-sm text-green-600",children:e.result})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u,{className:"h-4 w-4 text-red-600"}),(0,r.jsx)("span",{className:"text-sm text-red-600",children:e.error})]})})]})})},e.id))}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,r.jsx)("p",{className:"font-medium",children:"Exemplos:"}),(0,r.jsx)("p",{children:"• gasto mercado 150"}),(0,r.jsx)("p",{children:"• receita sal\xe1rio 5000"}),(0,r.jsx)("p",{children:"• despesa transporte 50"})]})]})]})}},43664:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var r=a(2265),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=(e,t)=>{let a=(0,r.forwardRef)((a,o)=>{let{color:i="currentColor",size:c=24,strokeWidth:l=2,absoluteStrokeWidth:d,className:u="",children:p,...m}=a;return(0,r.createElement)("svg",{ref:o,...s,width:c,height:c,stroke:i,strokeWidth:d?24*Number(l)/Number(c):l,className:["lucide","lucide-".concat(n(e)),u].join(" "),...m},[...t.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(p)?p:[p]])});return a.displayName="".concat(e),a}},41671:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},88226:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},92735:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},99637:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},25466:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},47692:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},58293:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]])},82718:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},99397:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},44743:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},32489:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(43664).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},27648:function(e,t,a){"use strict";a.d(t,{default:function(){return s.a}});var r=a(72972),s=a.n(r)},99376:function(e,t,a){"use strict";var r=a(35475);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})}}]);